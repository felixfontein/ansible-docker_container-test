---
- name: Registering container name
  set_fact:
    cname: "{{ cname_prefix ~ '-options' }}"
- name: Registering container name
  set_fact:
    cnames: "{{ cnames }} + [cname]"

####################################################################
## auto_remove #####################################################
####################################################################

- name: auto_remove
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "echo"'
    name: "{{ cname }}"
    state: started
    auto_remove: yes
  register: auto_remove_1

- name: Give container 1 second to be sure it terminated
  pause:
    seconds: 1

- name: auto_remove (verify)
  docker_container:
    name: "{{ cname }}"
    state: absent
  register: auto_remove_2

- assert:
    that:
    - auto_remove_1 is changed
    - auto_remove_2 is not changed

####################################################################
## blkio_weight ####################################################
####################################################################

- name: blkio_weight
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    blkio_weight: 123
  register: blkio_weight_1

- name: blkio_weight (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    blkio_weight: 123
  register: blkio_weight_2

- name: blkio_weight (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    blkio_weight: 234
    stop_timeout: 1
  register: blkio_weight_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - blkio_weight_1 is changed
    - blkio_weight_2 is not changed
    - blkio_weight_3 is changed

####################################################################
## cap_drop, capabilities ##########################################
####################################################################

- name: capabilities, cap_drop
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    capabilities:
    - sys_time
    cap_drop:
    - all
  register: capabilities_1

- name: capabilities, cap_drop (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    capabilities:
    - sys_time
    cap_drop:
    - all
  register: capabilities_2

- name: capabilities, cap_drop (less)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    capabilities: []
    cap_drop:
    - all
  register: capabilities_3

- name: capabilities, cap_drop (changed)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    capabilities:
    - setgid
    cap_drop:
    - all
    stop_timeout: 1
  register: capabilities_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - capabilities_1 is changed
    - capabilities_2 is not changed
    - capabilities_3 is not changed
    - capabilities_4 is changed

####################################################################
## cleanup #########################################################
####################################################################

# TODO: - cleanup

####################################################################
## command #########################################################
####################################################################

- name: command
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
  register: command_1

- name: command (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
  register: command_2

- name: command (less parameters)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    stop_timeout: 1
  register: command_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - command_1 is changed
    - command_2 is not changed
    - command_3 is changed

####################################################################
## cpu_period, cpu_quota ###########################################
####################################################################

# TODO: - cpu_period, cpu_quota

####################################################################
## cpu_shares ######################################################
####################################################################

# TODO: - cpu_shares

####################################################################
## cpuset_cpus #####################################################
####################################################################

# TODO: - cpuset_cpus

####################################################################
## cpuset_mems #####################################################
####################################################################

# TODO: - cpuset_mems

####################################################################
## debug ###########################################################
####################################################################

- name: debug (create)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: present
    debug: yes
  register: debug_1

- name: debug (start)
  docker_container:
    name: "{{ cname }}"
    state: started
    debug: yes
  register: debug_2

- name: debug (stop)
  docker_container:
    image: alpine:3.8
    name: "{{ cname }}"
    state: stopped
    stop_timeout: 1
    debug: yes
  register: debug_3

- name: debug (absent)
  docker_container:
    name: "{{ cname }}"
    state: absent
    debug: yes
    stop_timeout: 1
  register: debug_4

- assert:
    that:
    - debug_1 is changed
    - debug_2 is changed
    - debug_3 is changed
    - debug_4 is changed

####################################################################
## detach ##########################################################
####################################################################

# TODO: - detach

####################################################################
## devices #########################################################
####################################################################

- name: devices
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    devices:
    - "/dev/random:/dev/virt-random:rwm"
    - "/dev/urandom:/dev/virt-urandom:rwm"
  register: devices_1

- name: devices (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    devices:
    - "/dev/random:/dev/virt-random:rwm"
    - "/dev/urandom:/dev/virt-urandom:rwm"
  register: devices_2

- name: devices (less)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    devices:
    - "/dev/random:/dev/virt-random:rwm"
  register: devices_3

- name: devices (changed)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    devices:
    - "/dev/random:/dev/virt-random:rwm"
    - "/dev/null:/dev/virt-null:rwm"
    stop_timeout: 1
  register: devices_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - devices_1 is changed
    - devices_2 is not changed
    - devices_3 is not changed
    - devices_4 is changed

####################################################################
## dns_opts ########################################################
####################################################################

# TODO: - dns_opts

####################################################################
## dns_search_domains ##############################################
####################################################################

- name: dns_search_domains
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_search_domains:
    - example.com
    - example.org
  register: dns_search_domains_1

- name: dns_search_domains (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_search_domains:
    - example.com
    - example.org
  register: dns_search_domains_2

- name: dns_search_domains (less)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_search_domains:
    - example.com
  register: dns_search_domains_3

- name: dns_search_domains (changed)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_search_domains:
    - example.com
    - ansible.com
    stop_timeout: 1
  register: dns_search_domains_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - dns_search_domains_1 is changed
    - dns_search_domains_2 is not changed
    - dns_search_domains_3 is not changed
    - dns_search_domains_4 is changed

####################################################################
## dns_servers #####################################################
####################################################################

- name: dns_servers
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_servers:
    - 1.1.1.1
    - 8.8.8.8
  register: dns_servers_1

- name: dns_servers (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_servers:
    - 1.1.1.1
    - 8.8.8.8
  register: dns_servers_2

- name: dns_servers (less)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_servers:
    - 1.1.1.1
  register: dns_servers_3

- name: dns_servers (changed)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    dns_servers:
    - 1.1.1.1
    - 9.9.9.9
    stop_timeout: 1
  register: dns_servers_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - dns_servers_1 is changed
    - dns_servers_2 is not changed
    - dns_servers_3 is not changed
    - dns_servers_4 is changed

####################################################################
## domainname ######################################################
####################################################################

- name: domainname
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    domainname: example.com
    state: started
  register: domainname_1

- name: domainname (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    domainname: example.com
    state: started
  register: domainname_2

- name: domainname (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    domainname: example.org
    state: started
    stop_timeout: 1
  register: domainname_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - domainname_1 is changed
    - domainname_2 is not changed
    - domainname_3 is changed

####################################################################
## entrypoint ######################################################
####################################################################

- name: entrypoint
  docker_container:
    image: alpine:3.8
    entrypoint: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
  register: entrypoint_1

- name: entrypoint (idempotency)
  docker_container:
    image: alpine:3.8
    entrypoint: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
  register: entrypoint_2

- name: entrypoint (less parameters)
  docker_container:
    image: alpine:3.8
    entrypoint: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    stop_timeout: 1
  register: entrypoint_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - entrypoint_1 is changed
    - entrypoint_2 is not changed
    - entrypoint_3 is changed

####################################################################
## env #############################################################
####################################################################

- name: env
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    env:
      TEST1: val1
      TEST2: val2
  register: env_1

- name: env (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    env:
      TEST1: val1
      TEST2: val2
  register: env_2

- name: env (less environment variables)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    env:
      TEST1: val1
  register: env_3

- name: env (more environment variables)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    env:
      TEST1: val1
      TEST3: val3
    stop_timeout: 1
  register: env_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - env_1 is changed
    - env_2 is not changed
    - env_3 is not changed
    - env_4 is changed

####################################################################
## env_file #########################################################
####################################################################

- name: env_file
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    env_file: "{{ role_path }}/files/env-file"
  register: env_file_1

- name: env_file (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    env_file: "{{ role_path }}/files/env-file"
  register: env_file_2

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - env_file_1 is changed
    - env_file_2 is not changed

####################################################################
## etc_hosts #######################################################
####################################################################

- name: etc_hosts
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    etc_hosts:
      example.com: 1.2.3.4
      example.org: 4.3.2.1
  register: etc_hosts_1

- name: etc_hosts (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    etc_hosts:
      example.com: 1.2.3.4
      example.org: 4.3.2.1
  register: etc_hosts_2

- name: etc_hosts (less hosts)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    etc_hosts:
      example.com: 1.2.3.4
  register: etc_hosts_3

- name: etc_hosts (more hosts)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    etc_hosts:
      example.com: 1.2.3.4
      example.us: 1.2.3.5
    stop_timeout: 1
  register: etc_hosts_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - etc_hosts_1 is changed
    - etc_hosts_2 is not changed
    - etc_hosts_3 is not changed
    - etc_hosts_4 is changed

####################################################################
## exposed_ports ###################################################
####################################################################

- name: exposed_ports
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    exposed_ports:
    - 1234
    - 5678
  register: exposed_ports_1

- name: exposed_ports (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    exposed_ports:
    - 1234
    - 5678
  register: exposed_ports_2

- name: exposed_ports (less ports)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    exposed_ports:
    - 1234
  register: exposed_ports_3

- name: exposed_ports (more ports)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    exposed_ports:
    - 1234
    - 1235
    stop_timeout: 1
  register: exposed_ports_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - exposed_ports_1 is changed
    - exposed_ports_2 is not changed
    - exposed_ports_3 is not changed
    - exposed_ports_4 is changed

####################################################################
## force_kill ######################################################
####################################################################

# TODO: - force_kill

####################################################################
## groups ##########################################################
####################################################################

- name: groups
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    groups:
    - 1234
    - 5678
  register: groups_1

- name: groups (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    groups:
    - 1234
    - 5678
  register: groups_2

- name: groups (less groups)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    groups:
    - 1234
  register: groups_3

- name: groups (more groups)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
    groups:
    - 1234
    - 2345
    stop_timeout: 1
  register: groups_4

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - groups_1 is changed
    - groups_2 is not changed
    - groups_3 is not changed
    - groups_4 is changed

####################################################################
## hostname ########################################################
####################################################################

- name: hostname
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    hostname: me.example.com
    state: started
  register: hostname_1

- name: hostname (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    hostname: me.example.com
    state: started
  register: hostname_2

- name: hostname (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    hostname: me.example.org
    state: started
    stop_timeout: 1
  register: hostname_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - hostname_1 is changed
    - hostname_2 is not changed
    - hostname_3 is changed

####################################################################
## init ############################################################
####################################################################

# TODO: - init

####################################################################
## interactive #####################################################
####################################################################

# TODO: - interactive

####################################################################
## image / ignore_image ############################################
####################################################################

- name: image
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
  register: image_1

- name: image (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    state: started
  register: image_2

- name: ignore_image
  docker_container:
    image: hello-world
    ignore_image: yes
    name: "{{ cname }}"
    state: started
  register: ignore_image

- name: image change
  docker_container:
    image: hello-world
    name: "{{ cname }}"
    state: started
    stop_timeout: 1
  register: image_change

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - image_1 is changed
    - image_2 is not changed
    - ignore_image is not changed
    - image_change is changed

####################################################################
## ipc_mode ########################################################
####################################################################

# TODO: - ipc_mode

####################################################################
## keep_volumes ####################################################
####################################################################

# TODO: - keep_volumes

####################################################################
## kernel_memory ###################################################
####################################################################

- name: kernel_memory
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    kernel_memory: 8M
    state: started
  register: kernel_memory_1

- name: kernel_memory (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    kernel_memory: 8M
    state: started
  register: kernel_memory_2

- name: kernel_memory (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    kernel_memory: 6M
    state: started
    stop_timeout: 1
  register: kernel_memory_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - kernel_memory_1 is changed
    - kernel_memory_2 is not changed
    - kernel_memory_3 is changed

####################################################################
## kill_signal #####################################################
####################################################################

# TODO: - kill_signal

####################################################################
## labels ##########################################################
####################################################################

# TODO: - labels

####################################################################
## links ###########################################################
####################################################################

# TODO: - links

####################################################################
## log_driver ######################################################
####################################################################

# TODO: - log_driver

####################################################################
## log_options #####################################################
####################################################################

# TODO: - log_options

####################################################################
## mac_address #####################################################
####################################################################

- name: mac_address
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    mac_address: 92:d0:c6:0a:29:33
    state: started
  register: mac_address_1

- name: mac_address (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    mac_address: 92:d0:c6:0a:29:33
    state: started
  register: mac_address_2

- name: mac_address (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    mac_address: 92:d0:c6:0a:29:44
    state: started
    stop_timeout: 1
  register: mac_address_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - mac_address_1 is changed
    - mac_address_2 is not changed
    - mac_address_3 is changed

####################################################################
## memory ##########################################################
####################################################################

- name: memory
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    memory: 64M
    state: started
  register: memory_1

- name: memory (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    memory: 64M
    state: started
  register: memory_2

- name: memory (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    memory: 48M
    state: started
    stop_timeout: 1
  register: memory_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - memory_1 is changed
    - memory_2 is not changed
    - memory_3 is changed

####################################################################
## memory_reservation ##############################################
####################################################################

- name: memory_reservation
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    memory_reservation: 64M
    state: started
  register: memory_reservation_1

- name: memory_reservation (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    memory_reservation: 64M
    state: started
  register: memory_reservation_2

- name: memory_reservation (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    memory_reservation: 48M
    state: started
    stop_timeout: 1
  register: memory_reservation_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - memory_reservation_1 is changed
    - memory_reservation_2 is not changed
    - memory_reservation_3 is changed

####################################################################
## memory_swap #####################################################
####################################################################

- name: memory_swap
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    # Docker daemon does not accept memory_swap if memory is not specified
    memory: 32M
    memory_swap: 64M
    state: started
  register: memory_swap_1

- name: memory_swap (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    # Docker daemon does not accept memory_swap if memory is not specified
    memory: 32M
    memory_swap: 64M
    state: started
  register: memory_swap_2

- name: memory_swap (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    # Docker daemon does not accept memory_swap if memory is not specified
    memory: 32M
    memory_swap: 48M
    state: started
    stop_timeout: 1
  register: memory_swap_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - memory_swap_1 is changed
    - memory_swap_2 is not changed
    - memory_swap_3 is changed

####################################################################
## memory_swappiness ###############################################
####################################################################

- name: memory_swappiness
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    memory_swappiness: 40
    state: started
  register: memory_swappiness_1

- name: memory_swappiness (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    memory_swappiness: 40
    state: started
  register: memory_swappiness_2

- name: memory_swappiness (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    memory_swappiness: 60
    state: started
    stop_timeout: 1
  register: memory_swappiness_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - memory_swappiness_1 is changed
    - memory_swappiness_2 is not changed
    - memory_swappiness_3 is changed

####################################################################
## network_mode ####################################################
####################################################################

# TODO: - network_mode

####################################################################
## networks ########################################################
####################################################################

# TODO: - networks

####################################################################
## oom_killer ######################################################
####################################################################

# TODO: - oom_killer

####################################################################
## oom_score_adj ###################################################
####################################################################

# TODO: - oom_score_adj

####################################################################
## output_logs #####################################################
####################################################################

# TODO: - output_logs

####################################################################
## paused ##########################################################
####################################################################

# TODO: - paused

####################################################################
## pid_mode ########################################################
####################################################################

# TODO: - pid_mode

####################################################################
## privileged ######################################################
####################################################################

- name: privileged
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    privileged: yes
    state: started
  register: privileged_1

- name: privileged (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    privileged: yes
    state: started
  register: privileged_2

- name: privileged (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    privileged: no
    state: started
    stop_timeout: 1
  register: privileged_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - privileged_1 is changed
    - privileged_2 is not changed
    - privileged_3 is changed

####################################################################
## published_ports #################################################
####################################################################

# TODO: - published_ports

####################################################################
## pull ############################################################
####################################################################

# TODO: - pull

####################################################################
## purge_networks ##################################################
####################################################################

# TODO: - purge_networks

####################################################################
## read_only #######################################################
####################################################################

- name: read_only
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    read_only: yes
    state: started
  register: read_only_1

- name: read_only (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    read_only: yes
    state: started
  register: read_only_2

- name: read_only (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    read_only: no
    state: started
    stop_timeout: 1
  register: read_only_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - read_only_1 is changed
    - read_only_2 is not changed
    - read_only_3 is changed

####################################################################
## recreate ########################################################
####################################################################

# TODO: - recreate

####################################################################
## restart #########################################################
####################################################################

# TODO: - restart

####################################################################
## restart_policy ##################################################
####################################################################

# TODO: - restart_policy

####################################################################
## restart_retries #################################################
####################################################################

# TODO: - restart_retries

####################################################################
## shm_size ########################################################
####################################################################

- name: shm_size
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    shm_size: 96M
    state: started
  register: shm_size_1

- name: shm_size (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    shm_size: 96M
    state: started
  register: shm_size_2

- name: shm_size (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    shm_size: 75M
    state: started
    stop_timeout: 1
  register: shm_size_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - shm_size_1 is changed
    - shm_size_2 is not changed
    - shm_size_3 is changed

####################################################################
## stop_signal #####################################################
####################################################################

# TODO: - stop_signal

####################################################################
## stop_timeout ####################################################
####################################################################

# TODO: - stop_timeout

####################################################################
## sysctls #########################################################
####################################################################

# TODO: - sysctls

####################################################################
## timeout #########################################################
####################################################################

# TODO: - timeout

####################################################################
## tmpfs ###########################################################
####################################################################

# TODO: - tmpfs

####################################################################
## trust_image_content #############################################
####################################################################

# TODO: - trust_image_content

####################################################################
## tty #############################################################
####################################################################

# TODO: - tty

####################################################################
## ulimits #########################################################
####################################################################

# TODO: - ulimits

####################################################################
## user ############################################################
####################################################################

- name: user
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    user: nobody
    state: started
  register: user_1

- name: user (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    user: nobody
    state: started
  register: user_2

- name: user (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    user: root
    state: started
    stop_timeout: 1
  register: user_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - user_1 is changed
    - user_2 is not changed
    - user_3 is changed

####################################################################
## userns_mode #####################################################
####################################################################

# TODO: - userns_mode

####################################################################
## uts #############################################################
####################################################################

# TODO: - uts

####################################################################
## volume_driver ###################################################
####################################################################

# TODO: - volume_driver

####################################################################
## volumes #########################################################
####################################################################

# TODO: - volumes

####################################################################
## volumes_from ####################################################
####################################################################

# TODO: - volumes_from

####################################################################
## working_dir #####################################################
####################################################################

- name: working_dir
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    working_dir: /tmp
    state: started
  register: working_dir_1

- name: working_dir (idempotency)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -v -c "sleep 10m"'
    name: "{{ cname }}"
    working_dir: /tmp
    state: started
  register: working_dir_2

- name: working_dir (change)
  docker_container:
    image: alpine:3.8
    command: '/bin/sh -c "sleep 10m"'
    name: "{{ cname }}"
    working_dir: /
    state: started
    stop_timeout: 1
  register: working_dir_3

- name: cleanup
  docker_container:
    name: "{{ cname }}"
    state: absent
    stop_timeout: 1

- assert:
    that:
    - working_dir_1 is changed
    - working_dir_2 is not changed
    - working_dir_3 is changed
